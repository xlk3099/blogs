---
title: "Goè¯­è¨€å®æˆ˜è¯»ä¹¦ç¬”è®°ï¼ˆåäº”ï¼‰: å¹¶å‘æ¨¡å¼ - Work"
date: 2018-04-16T18:45:06+08:00
draft: false
author: "xlk3099"
categories: ["golang"]
tags: ["Go In Action"]
---

work åŒ…åˆ©ç”¨äº†æ— ç¼“å†²é€šé“æ¥åˆ›å»ºä¸€ä¸ªgoroutineæ± , (æ³¨æ„, ä¸Šä¸€ç« æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªèµ„æºæ± , è¿™é‡Œæˆ‘ä»¬åˆ›å»ºçš„æ˜¯goroutineæ± ) è¿™äº›goroutineæ‰§è¡Œå¹¶æ§åˆ¶ä¸€ç»„å·¥ä½œ, è®©å…¶å¹¶å‘æ‰§è¡Œ. è¿™ç§caseä¸‹, ä½¿ç”¨æ— ç¼“å†²é€šé“çš„æ•ˆæœæ¯”éšæ„æŒ‡å®šä¸€ä¸ªæœ‰ç¼“å†²åŒºé€šé“å¥½, å› ä¸ºè¿™ç§caseä¸‹ä¸éœ€è¦ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—, ä¹Ÿä¸éœ€è¦ä¸€ç»„goroutine é…åˆæ‰§è¡Œ. æ— ç¼“å†²é€šé“çš„ä¸€å¤§å¥½å¤„, å°±æ˜¯ä¿è¯äº†ä¸¤ä¸ªgoroutineä¹‹é—´çš„æ•°æ®äº¤æ¢. ä½¿ç”¨æ— ç¼“å†²é€šé“çš„æ–¹æ³•å…è®¸ä½¿ç”¨è€…çŸ¥é“ä»€ä¹ˆæ—¶å€™goroutineæ± æ­£åœ¨æ‰§è¡Œå·¥ä½œ, å¦‚æœé‡Œé¢æ‰€æœ‰çš„goroutineéƒ½å¿™, æ— æ³•æ¥å—æ–°çš„å·¥ä½œ, ä¹Ÿèƒ½é€šè¿‡é€šé“æ¥å‘Šè¯‰è°ƒç”¨è€….

è¿™ä¹ˆçœ‹æ¥, è¿™ç« å…¶å®å«åšgoroutine poolæ›´å¥½...ğŸ˜

å†ç”¨Poolçš„åå­—æœ‰ç‚¹ä¿—äº†, æ—¢ç„¶å·²ç»è®²è¿°äº†å¤§æ¦‚çš„åŸç†, æˆ‘ä»¬å°±æ¢ä¸ªç±»å‹å§. èµ·ä¸€æ®µæ—¶é—´åˆšçœ‹äº†å…¨èŒçŒäººåŠ¨æ¼«, ä¸Šé¢æ˜¯Poolè·ŸWorkerçš„å…³ç³», æˆ‘ä»¬å°±ä½¿ç”¨Guildè·ŸHunterçš„å…³ç³»å§.

```go

// å®šä¹‰çŒäººå…¬ä¼š
type Guild struct {
    taskboard chan Task
    wg sync.WaitGroup
    members []Member
}

type Task int64
```
ä¸Šé¢æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªçŒäººå…¬ä¼šç±»å‹, çŒäººå…¬ä¼šæœ‰ä¸€ä¸ªä»»åŠ¡é¢æ¿(taskboard), å¯ä»¥æ¥å—Taskç±»å‹æ•°æ®,
è¿˜æœ‰ä¸€ä¸ªWaitGroupå‚æ•°, ç”¨æ¥ç­‰å¾…æ‰€æœ‰Taskå®Œæˆ. è¿™é‡Œç®€å•èµ·è§, æˆ‘ä»¬å®šä¹‰Taskä¸ºint64çš„é‡å‘½åç±»å‹, ç”¨æ¥è¡¨ç¤ºTask ID.

æœ‰äº†å…¬ä¼šæˆ‘ä»¬è‚¯å®šéœ€è¦çŒäºº:

```go
type Member interface {
    Exec(Task)
}

type Hunter struct {
    id int
}

func (h *Hunter) Exec(t Task) {
    fmt.Println("çŒäººæ‰§è¡Œä»»åŠ¡:" t)
}


```
å®šä¹‰ä¸€ä¸ªçŒäººæ¥å£, æ¥å£æœ‰ä¸ªå‡½æ•°Exec(Task), è¡¨ç¤ºçŒäººéœ€è¦æ‰§è¡ŒTask

å…¬ä¼šè¿˜éœ€è¦æœ‰å…¶ä»–æ–¹æ³•, æ¯”å¦‚å·¥å‚å‡½æ•°, ç»™å®šå¤§å°, å»ºé€ ä¸€ä¸ªæ–°çš„å…¬ä¼š, æŒ‡å®šå…¬ä¼šäººæ•°, æ·»åŠ æ–°çš„ä»»åŠ¡ç­‰ç­‰.

```go
// è¿™é‡Œsizeè™½ç„¶è¡¨ç¤ºçš„å…¬ä¼šäººæ•°å¤§å°, å…¶å®æ˜¯åšå¤šèƒ½åŒæ—¶æ‰§è¡Œçš„goroutines.
func New (size int) * Guild {
    g := Guild {
        taskboard: make(chan Task),
        members : make([]Hunter, size),
    }
    g.wg.Add(size)

    for member := members {
        go func(m Member) {
            for t := range g.taskboard {
                m.Exec(i)
            }
        }(member)
    }
    return &g
}
```
